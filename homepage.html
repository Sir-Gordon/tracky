<html>

<head>
    <title>TRACKY</title>
    <!---This is for the title icon--->
    <link rel="stylesheet" href="style.css">
    <link rel="icon" sizes="32x32" href="tracky_logo_v3.png">
    <link href="https://fonts.googleapis.com/css?family=Rubik" rel="stylesheet">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.7.2/css/all.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js">
    </script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js">
    </script>
</head>

<script>

    $(document).ready(function(){
    $('#searchbox').keyup(function(event){
      
        var keycode = (event.keyCode ? event.keyCode : event.which);
        if(keycode == '13'){
            var searchterm = $('#searchbox').val(); 
            var URL = "http://localhost:8080/searchlist";

            var expression = new RegExp(searchterm, "i");
            var n = {     
                "searchterm": searchterm,
            };
            $.ajax({      //get request to server
                type: "GET",
                url: URL,
                data: n,
                dataType : "jsonp",
                success: function(msg){
                    
                    
                    /* make items in the list get created with an add button to the right of it. Have to have a function that add the info to the portfolio page */ 
                    $('#result').html('<br>');
                    for(var i=0; i<msg.bestMatches.length; i++) {
                        $('#result').append('<li class="list-group-item">'+ msg.bestMatches[i]["1. symbol"] + '  :  '+ msg.bestMatches[i]["2. name"]);
                        console.log(msg.bestMatches[i]["2. name"]) ;}
                        
                    $('#result').on('click', 'li', function() {
                        var click_text = $(this).text().split('|');
                        $('#searchterm').val($.trim(click_text[0]));
                        $("#result").html('');
                        $("#stock").html(click_text);
                        document.getElementById("form").style.display = "block";
                        
                        console.log(click_text);
                    })
                            
                        $(document).mouseup(function (e) {
                            var container = $("#form");
                                
                        if (!container.is(e.target) // if the target of the click isn't the container...
                            && container.has(e.target).length === 0) // ... nor a descendant of the container
                            {
                            container.fadeOut();
                            }
                                });
                },
                error: function(jgXHR, textStatus, errorThrown){
                        alert("Error:" + textStatus + " " + errorThrown);
                    }
                });
        }})});

    $(function() {  
        // contact form animations
        $('#popup-body').click(function() {
        $('#form').fadeToggle();
        })
        $(document).mouseup(function (e) {
            var container = $("#form");

        if (!container.is(e.target) // if the target of the click isn't the container...
        && container.has(e.target).length === 0) // ... nor a descendant of the container
        {
        container.fadeOut();
        }
        });
  
    });
    
</script>
    
<body>
    
    <div id="header">
        <div class="inner-header">
            <ul class="navigation">
                <li><a href="homepage.html" class="hover">Home</a></li>
                <li><a href="Signup.html" class="hover">Sign Up</a></li>
                <li><a href="login.html" class="hover">Log In</a></li>
                <a href="portfolio.html"><img alt="Tracky Logo" src="tracky_logo_v3.png" width="80" height="80"></a>
            </ul>
        </div>
    </div>
    
    <br>
    
    <div class="search-box">
        <input class="search-txt" type="text" name="" placeholder="Type to search" id="searchbox">
        <a class="search-btn" href="#" onclick="searchterm()">
            <i class="fas fa-search-dollar"></i>
        </a>
        <br>
        <div id=result-div>
        <ul id="result" class="list-group"></ul>
        </div>
    </div>

    <!----POP UP FORM----->
    
    <div class="popup-body">
        <div id="popup">
        </div>
    
        <div id="form">
            <form action="http://localhost:8080/myaction">
                <h2 id='stock'>stock here </h2>
                <br>
                <label>Cost of Stock at Purchase</label>
                <input class="popup-input" id="pu-boughtprice" type="text" required>

                <label> Number of Shares Own</label>
                <input class="popup-input" id="pu-shares" placeholder="Number of Shares" type="text" required>

                <input class="formBtn" type="submit"/>
            </form>
        </div>
    </div>
</body>

</html>