<html>
    
<head>
<title>TRACKY</title>
<link rel = "icon" sizes = "32x32" href = "tracky_logo_v3.png">
<link href="https://fonts.googleapis.com/css?family=Rubik" rel="stylesheet">
<link rel="stylesheet" href="style.css">
<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.7.2/css/all.css">
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js">
</script>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js">
</script>

<script>

function getprofile(){
    Url= 'http://localhost:8080/getprofile'
    $.ajax({
        url: Url,
        type: 'GET',
        dataType : "jsonp",
        success: function(msg) {
            document.getElementById("empty").innerHTML ='<table  align="center" id="mytable"><thead><tr><th></th><th>Company</th><th>Symbol</th><th>Price</th><th>No. of Shares</th><th>Holding Value</th><th>% of Portfolio</th><th>Purchase Price</th><th>Gain/Lost</th></tr></thead></table>'
            console.log(msg);
            table =''
            totalprice = 0;
            $.each(msg, function(i,item){
                var holdvalue = parseFloat(item.Price) * parseInt(item.Shares);
                console.log(parseFloat(item.Price));
                totalprice += holdvalue;
            });
            console.log(totalprice);
            $.each(msg, function(i,item){
                var stock = item.Symbol;
                var holdvalue = parseFloat(item.Price * item.Shares) ;
                var percent = parseFloat(holdvalue) / totalprice * 100;
                var netgain = holdvalue - (parseFloat(item.PurchasePrice) * parseFloat(item.Shares));
                table += '<tr><td><img src="'+ item.logo +'" height="20" width="20"</td><td>' + item.Company +'</td><td>' + item.Symbol +'</td><td>$' +item.Price+'</td><td>' + item.Shares + '</td><td>$' + holdvalue.toFixed(2) +'</td><td>' +percent.toFixed(2)+'%</td><td>$' + item.PurchasePrice + '</td><td>' + netgain.toFixed(2) + '</td>'
            })
            

            $('#mytable').append(table);
        
    }
});
}


function getprice(stock, callback){
    URL2 = 'https://api.iextrading.com/1.0/stock/'+ stock+'/batch?types=quote'
    price= []
    $.ajax({
        url: URL2,
        type: 'GET',
        dataType : "jsonp",
    success: function(msg) {
        lastestprice = msg.quote.latestPrice;
        price.push(lastestprice)
    }
    });
    callback();
}

</script>
</head> 

<body>
<div id = "header">
    <div class = "inner-header">
        <ul class = "navigation">
            <li><a href="homepage.html" class="hover">Home</a></li>
            <li><a href="Signup.html" class="hover">Sign Up</a></li>
            <li><a href="login.html" class="hover">Log In</a></li>
            <a href="portfolio.html"><img alt="Tracky Logo" src="tracky_logo_v3.png" width="80" height="80"></a>
        </ul>
    </div>
</div>
<input type="button" onclick="getprofile()" class="getprofile" value="Show Profile">
<div class="port-display" id = 'empty'>
</div>


</body>
</html>